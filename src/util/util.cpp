#include "util.h"
#include <math.h>

uint8_t cap(int r) {
    static const uint8_t gamma8[] = {
        0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
        0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1,  1,  1,  1,
        1,  1,  1,  1,  1,  1,  1,  1,  1,  2,  2,  2,  2,  2,  2,  2,
        2,  3,  3,  3,  3,  3,  3,  3,  4,  4,  4,  4,  4,  5,  5,  5,
        5,  6,  6,  6,  6,  7,  7,  7,  7,  8,  8,  8,  9,  9,  9, 10,
        10, 10, 11, 11, 11, 12, 12, 13, 13, 13, 14, 14, 15, 15, 16, 16,
        17, 17, 18, 18, 19, 19, 20, 20, 21, 21, 22, 22, 23, 24, 24, 25,
        25, 26, 27, 27, 28, 29, 29, 30, 31, 32, 32, 33, 34, 35, 35, 36,
        37, 38, 39, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 50,
        51, 52, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 66, 67, 68,
        69, 70, 72, 73, 74, 75, 77, 78, 79, 81, 82, 83, 85, 86, 87, 89,
        90, 92, 93, 95, 96, 98, 99,101,102,104,105,107,109,110,112,114,
        115,117,119,120,122,124,126,127,129,131,133,135,137,138,140,142,
        144,146,148,150,152,154,156,158,160,162,164,167,169,171,173,175,
        177,180,182,184,186,189,191,193,196,198,200,203,205,208,210,213,
        215,218,220,223,225,228,231,233,236,239,241,244,247,249,252,255 };
    if (r < 0) {
        return 0;
    }
    if (r > 255) {
        return 255;
    }
    return gamma8[r];
}

float triangle_wave(int x) {
    static float memoize[100] = {0};
    int i = (x % (100));
    float *p = memoize + i;
    if (!*p) {
        *p = fabs(i - 50) / (float)50;
    }
    return *p;
} 
float sind(uint32_t d) {
    static const float LUT[] = {
        0,  0.034899497,  0.052335956,  0.069756474,  0.087155743,
        0.104528463,  0.121869343,  0.139173101,  0.156434465,  0.173648178,
        0.190808995,  0.207911691,  0.224951054,  0.241921896,  0.258819045,
        0.275637356,  0.292371705,  0.309016994,  0.325568154,  0.342020143,
        0.35836795,  0.374606593,  0.390731128,  0.406736643,  0.422618262,
        0.438371147,  0.4539905,  0.469471563,  0.48480962,  0.5,  0.515038075,
        0.529919264,  0.544639035,  0.559192903,  0.573576436,  0.587785252,
        0.601815023,  0.615661475,  0.629320391,  0.64278761,  0.656059029, 
        0.669130606,  0.68199836,  0.69465837,  0.707106781,  0.7193398,
        0.731353702,  0.743144825,  0.75470958,  0.766044443,  0.777145961, 
        0.788010754,  0.79863551,  0.809016994,  0.819152044,  0.829037573, 
        0.838670568,  0.848048096,  0.857167301,  0.866025404,  0.874619707,
        0.882947593,  0.891006524,  0.898794046,  0.906307787,  0.913545458,
        0.920504853,  0.927183855,  0.933580426,  0.939692621,  0.945518576,
        0.951056516,  0.956304756,  0.961261696,  0.965925826,  0.970295726,
        0.974370065,  0.978147601,  0.981627183,  0.984807753,  0.987688341,
        0.990268069,  0.992546152,  0.994521895,  0.996194698,  0.99756405,
        0.998629535,  0.999390827,  0.999847695,  1,  0.999847695,  0.999390827, 
        0.998629535,  0.99756405,  0.996194698,  0.994521895,  0.992546152,  
        0.990268069,  0.987688341,  0.984807753,  0.981627183,  0.978147601,
        0.974370065,  0.970295726,  0.965925826,  0.961261696,  0.956304756,
        0.951056516,  0.945518576,  0.939692621,  0.933580426,  0.927183855,  
        0.920504853,  0.913545458,  0.906307787,  0.898794046,  0.891006524,
        0.882947593,  0.874619707,  0.866025404,  0.857167301,  0.848048096,
        0.838670568,  0.829037573,  0.819152044,  0.809016994,  0.79863551,
        0.788010754,  0.777145961,  0.766044443,  0.75470958,  0.743144825,
        0.731353702,  0.7193398,  0.707106781,  0.69465837,  0.68199836,  0.669130606,
        0.656059029,  0.64278761,  0.629320391,  0.615661475,  0.601815023, 
        0.587785252,  0.573576436,  0.559192903,  0.544639035,  0.529919264,  
        0.515038075,  0.5,  0.48480962,  0.469471563,  0.4539905,  0.438371147,  
        0.422618262,  0.406736643,  0.390731128,  0.374606593,  0.35836795,  
        0.342020143,  0.325568154,  0.309016994,  0.292371705,  0.275637356,  
        0.258819045,  0.241921896,  0.224951054,  0.207911691,  0.190808995,  
        0.173648178,  0.156434465,  0.139173101,  0.121869343,  0.104528463,  
        0.087155743,  0.069756474,  0.052335956,  0.034899497,  0.017452406,  0};
    if (d < 0 || d >= 180) {
        return 0;
    }
    return LUT[d];
} 
